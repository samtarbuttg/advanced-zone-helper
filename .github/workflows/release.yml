name: Release

on:
  push:
    tags: ['v*']

jobs:
  release:
    needs: test
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4

      - name: Create PCM package
        run: python build_pcm.py ${{ github.ref_name }}

      - name: Create GitHub Release
        uses: softprops/action-gh-release@v2
        with:
          files: dist/advanced-zone-helper-ipc-${{ github.ref_name }}-pcm.zip
          body: |
            # Advanced Zone Helper IPC ${{ github.ref_name }}

            KiCad 9.0+ IPC API version - create zones from selected shapes

            ## Installation
            1. Download the PCM package ZIP file below
            2. Open KiCad → Plugin and Content Manager → Install from File
            3. Select the downloaded ZIP file
            4. Restart KiCad
            5. Enable IPC API in Preferences → Plugins (if not already enabled)

            ## Features
            - Create zones from selected graphic shapes
            - Support for simple zones, ring zones (with holes), and multi-hole zones
            - Automatic loop detection from disconnected shapes
            - Interactive zone selection and configuration dialog

            ## Requirements
            - KiCad 9.0+
            - Python 3.9+
            - wxPython 4.2+ (auto-installed on Windows/macOS)

            ## Troubleshooting
            If you see a "Missing required package" error, KiCad's automatic dependency installation may have failed. Run `setup_dependencies.py` from the plugin folder or see README.md for manual installation instructions.

            ## Documentation
            See README.md in the repository for detailed usage instructions.
